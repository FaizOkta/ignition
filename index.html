<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partner Portal - Ignition Technology</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Okta Auth JS SDK -->
    <script src="https://global.oktacdn.com/okta-auth-js/7.7.0/okta-auth-js.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Open Sans', Arial, sans-serif; background-color: #0b1f2a; color: #333; min-height: 100vh; }

        /* Top Header - Dark teal/navy */
        .top-header { background-color: #0b1f2a; padding: 15px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .top-header-content { max-width: 1400px; margin: 0 auto; padding: 0 40px; display: flex; justify-content: space-between; align-items: center; }
        .logo-section { display: flex; align-items: center; gap: 15px; }
        .logo-text { color: white; font-size: 28px; font-weight: 700; text-transform: uppercase; letter-spacing: 3px; line-height: 1.2; }
        .logo-text span { display: block; }
        .contact-link { color: white; text-decoration: none; font-size: 14px; display: flex; align-items: center; gap: 10px; }
        .contact-link:hover { color: #3bc4d4; }

        /* Cyan Bar */
        .cyan-bar { background: linear-gradient(90deg, #3bc4d4 0%, #2fa8b6 100%); padding: 12px 0; position: relative; }
        .cyan-bar-content { max-width: 1400px; margin: 0 auto; padding: 0 40px; text-align: right; }
        .account-dropdown { position: relative; display: inline-block; }
        .your-account { color: white; font-size: 16px; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 15px; border-radius: 4px; transition: background-color 0.3s; }
        .your-account:hover { background-color: rgba(255, 255, 255, 0.1); }
        .dropdown-menu { position: absolute; top: 100%; right: 0; background: white; min-width: 200px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); border-radius: 4px; margin-top: 8px; opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.3s ease; z-index: 1000; }
        .account-dropdown:hover .dropdown-menu { opacity: 1; visibility: visible; transform: translateY(0); }
        .dropdown-menu a { display: block; padding: 12px 20px; color: #333; text-decoration: none; transition: background-color 0.3s; font-size: 14px; }
        .dropdown-menu a:hover { background-color: #f5f5f5; color: #3bc4d4; }

        /* Welcome Message */
        .welcome-message { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 15px; text-align: center; font-size: 16px; font-weight: 600; display: none; }
        .welcome-message.show { display: block; }

        /* Main Content */
        .main-content { background-color: #f5f5f5; min-height: calc(100vh - 300px); padding: 40px 0; }
        .content-wrapper { max-width: 1400px; margin: 0 auto; padding: 0 40px; }
        .breadcrumb { margin-bottom: 30px; font-size: 14px; color: #666; }
        .breadcrumb a { color: #666; text-decoration: none; }
        .breadcrumb a:hover { color: #3bc4d4; }
        .breadcrumb .current { color: #3bc4d4; font-weight: 600; }
        .page-title { font-size: 42px; font-weight: 700; color: #1a1a1a; margin-bottom: 20px; line-height: 1.2; }
        .page-title .highlight { color: #3bc4d4; }
        .page-description { color: #666; line-height: 1.8; margin-bottom: 40px; font-size: 15px; max-width: 900px; }

        /* Banner Image */
        .banner-image-container { margin-top: 40px; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); }
        .banner-image-container img { width: 100%; height: auto; display: block; }

        /* Footer */
        .footer { background-color: #0b1f2a; color: white; padding: 30px 0; }
        .footer-content { max-width: 1400px; margin: 0 auto; padding: 0 40px; text-align: center; }
        .footer a { color: #3bc4d4; text-decoration: none; }
        .footer a:hover { text-decoration: underline; }

        @media (max-width: 768px) {
            .top-header-content, .cyan-bar-content, .content-wrapper { padding: 0 20px; }
            .logo-text { font-size: 20px; }
            .page-title { font-size: 32px; }
        }
    </style>
</head>
<body>
    <!-- Top Header -->
    <div class="top-header">
        <div class="top-header-content">
            <div class="logo-section">
                <div class="logo-text">
                    <span>IGNITION</span>
                </div>
            </div>
            <div>
                <a href="https://www.ignition-technology.com/contact/" class="contact-link">
                    Contact us
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>

    <!-- Welcome Message -->
    <div class="welcome-message" id="welcomeMessage">
        âœ“ Successfully authenticated! Welcome to the Ignition Technology Portal.
    </div>

    <!-- Cyan Bar with Dropdown -->
    <div class="cyan-bar">
        <div class="cyan-bar-content">
            <div class="account-dropdown">
                <div class="your-account">
                    Your Account
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>
                <div class="dropdown-menu" id="dropdownMenu">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-wrapper">
            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" style="display: inline; vertical-align: middle;">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <a href="#">Home</a> / <span class="current">Partner Portal</span>
            </div>

            <!-- Page Title -->
            <h1 class="page-title" id="pageTitle">Login to your <span class="highlight">Partner Portal.</span></h1>
            <p class="page-description" id="pageDescription">
                On this partner portal you can access services/features & information you may need. 
                It contains features such as Order tracking, Available stocks, Price list, Invoices. 
                This partner portal is a digital sharing mechanism and information center between 
                Ignition Technology and its partners and can be accessed with sign in credentials.
            </p>

            <!-- Banner Image -->
            <div class="banner-image-container">
                <img src="enetworks.png" alt="Ignition Technology - Cybersecurity Distribution">
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-content">
            <p>&copy; 2026 Ignition Technology. All rights reserved.</p>
            <p style="margin-top: 10px;">
                <a href="#">Privacy Policy</a> | 
                <a href="#">Terms of Service</a> | 
                <a href="https://www.ignition-technology.com/contact/">Support</a>
            </p>
        </div>
    </div>

    <script>
        /***********************
         * OKTA CONFIGURATION
         ***********************/
        const OKTA_DOMAIN = "login.partnertwo.org";
        const CLIENT_ID = "0oazpnnecis3YdhQM697";
        const ISSUER = `https://${OKTA_DOMAIN}/oauth2/default`;
        
        // MUST MATCH YOUR OKTA APP REDIRECT URI
        const REDIRECT_URI = "https://ignition-lime.vercel.app/";

        // Initialize Okta Auth Client
        const authClient = new OktaAuth({
            issuer: ISSUER,
            clientId: CLIENT_ID,
            redirectUri: REDIRECT_URI,
            scopes: ['openid', 'profile', 'email'],
            pkce: true,
            responseType: 'code',
            tokenManager: {
                storage: 'localStorage'
            }
        });

        // Show welcome message
        function showWelcome() {
            const welcomeMsg = document.getElementById('welcomeMessage');
            welcomeMsg.classList.add('show');
            setTimeout(() => {
                welcomeMsg.classList.remove('show');
            }, 5000);
        }

        // Update UI for logged in state
        function setLoggedInUI(userInfo) {
            document.getElementById('pageTitle').innerHTML = 
                'Welcome to your <span class="highlight">Partner Portal.</span>';
            document.getElementById('pageDescription').textContent = 
                'You are now securely authenticated. Access your orders, invoices, and real-time stock information.';

            const dropdown = document.getElementById('dropdownMenu');
            dropdown.innerHTML = `
                <a href="#" id="logoutLink">Logout</a>
            `;
            
            document.getElementById('logoutLink').addEventListener('click', handleLogout);
        }

        // Update UI for logged out state
        function setLoggedOutUI() {
            document.getElementById('pageTitle').innerHTML = 
                'Login to your <span class="highlight">Partner Portal.</span>';
            document.getElementById('pageDescription').textContent = 
                'On this partner portal you can access services/features & information you may need. It contains features such as Order tracking, Available stocks, Price list, Invoices. This partner portal is a digital sharing mechanism and information center between Ignition Technology and its partners and can be accessed with sign in credentials.';

            const dropdown = document.getElementById('dropdownMenu');
            dropdown.innerHTML = `
                <a href="#" id="loginLink">Log in</a>
            `;
            
            document.getElementById('loginLink').addEventListener('click', handleLogin);
        }

        // Handle login - EXPLICIT APPROACH
        async function handleLogin(e) {
            e.preventDefault();
            
            try {
                console.log('Initiating login...');
                
                // Use the SDK's built-in method with explicit options
                await authClient.token.getWithRedirect({
                    responseType: 'code',
                    scopes: ['openid', 'profile', 'email'],
                    // Force prompt to ensure we go through login
                    prompt: 'login'
                });
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed: ' + error.message);
            }
        }

        // Handle logout
        async function handleLogout(e) {
            e.preventDefault();
            
            try {
                console.log('Logging out...');
                await authClient.signOut({
                    postLogoutRedirectUri: REDIRECT_URI
                });
            } catch (error) {
                console.error('Logout error:', error);
                // Force logout by clearing tokens and reloading
                authClient.tokenManager.clear();
                window.location.href = REDIRECT_URI;
            }
        }

        // Initialize the application
        async function init() {
            try {
                console.log('Initializing app...');
                
                // Check if we're coming back from Okta redirect
                if (authClient.isLoginRedirect()) {
                    console.log('Handling login redirect...');
                    
                    // Handle the callback
                    await authClient.handleLoginRedirect();
                    
                    // Clean up URL
                    window.history.replaceState({}, document.title, REDIRECT_URI);
                    
                    // Show welcome message
                    showWelcome();
                }

                // Check if user is authenticated
                const isAuthenticated = await authClient.isAuthenticated();
                console.log('Is authenticated:', isAuthenticated);

                if (isAuthenticated) {
                    // Get user info
                    const userInfo = await authClient.getUser();
                    console.log('User info:', userInfo);
                    setLoggedInUI(userInfo);
                } else {
                    setLoggedOutUI();
                }
            } catch (error) {
                console.error('Initialization error:', error);
                
                // Clear any stuck auth state
                try {
                    await authClient.tokenManager.clear();
                } catch (e) {
                    console.error('Error clearing tokens:', e);
                }
                
                setLoggedOutUI();
            }
        }

        // Start the app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
